import{a7 as S,ci as u,c9 as M,f8 as $,c7 as V,c2 as F,c1 as _,cQ as j,f9 as K,fa as U,fb as W,cG as D,fc as q,O as Q,bV as w,bI as z,a6 as I,bX as B,cj as X,cg as Y,fd as J,fe as Z,_ as ee,ff as te,a5 as se,ad as L,B as k,az as H,aH as ne,fg as re,b_ as ie,b$ as ae,fh as oe,fi as ce,fj as ue,bi as fe,cS as le,cl as P,ch as de,bK as he,bM as xe,bL as me,bO as be,bg as ge,ck as O,fk as ye,bx as pe,cc as we,l as Pe,m as ze,fl as Ie}from"./index-B0BpL7d4.js";class Te extends S{constructor(t){super(`Call bundle failed with status: ${t.statusCode}`,{name:"BundleFailedError"}),Object.defineProperty(this,"result",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.result=t}}const ve="0x5792579257925792579257925792579257925792579257925792579257925792",Ee=u(0,{size:32});async function Fe(e,t){async function n(c){if(c.endsWith(ve.slice(2))){const h=F(_(c,-64,-32)),d=_(c,0,-64).slice(2).match(/.{1,64}/g),y=await Promise.all(d.map(m=>Ee.slice(2)!==m?e.request({method:"eth_getTransactionReceipt",params:[`0x${m}`]},{dedupe:!0}):void 0)),b=y.some(m=>m===null)?100:y.every(m=>m?.status==="0x1")?200:y.every(m=>m?.status==="0x0")?500:600;return{atomic:!1,chainId:M(h),receipts:y.filter(Boolean),status:b,version:"2.0.0"}}return e.request({method:"wallet_getCallsStatus",params:[c]})}const{atomic:s=!1,chainId:r,receipts:i,version:o="2.0.0",...a}=await n(t.id),[l,f]=(()=>{const c=a.status;return c>=100&&c<200?["pending",c]:c>=200&&c<300?["success",c]:c>=300&&c<700?["failure",c]:c==="CONFIRMED"?["success",200]:c==="PENDING"?["pending",100]:[void 0,c]})();return{...a,atomic:s,chainId:r?M(r):void 0,receipts:i?.map(c=>({...c,blockNumber:V(c.blockNumber),gasUsed:V(c.gasUsed),status:$[c.status]}))??[],statusCode:f,status:l,version:o}}async function Re(e,t){const{id:n,pollingInterval:s=e.pollingInterval,status:r=({statusCode:b})=>b===200||b>=300,retryCount:i=4,retryDelay:o=({count:b})=>~~(1<<b)*200,timeout:a=6e4,throwOnFailure:l=!1}=t,f=j(["waitForCallsStatus",e.uid,n]),{promise:c,resolve:x,reject:h}=K();let d;const y=U(f,{resolve:x,reject:h},b=>{const m=W(async()=>{const T=p=>{clearTimeout(d),m(),p(),y()};try{const p=await D(async()=>{const g=await q(e,Fe,"getCallsStatus")({id:n});if(l&&g.status==="failure")throw new Te(g);return g},{retryCount:i,delay:o});if(!r(p))return;T(()=>b.resolve(p))}catch(p){T(()=>b.reject(p))}},{interval:s,emitOnBegin:!0});return m});return d=a?setTimeout(()=>{y(),clearTimeout(d),h(new Ce({id:n}))},a):void 0,await c}class Ce extends S{constructor({id:t}){super(`Timed out while waiting for call bundle with id "${t}" to be confirmed.`,{name:"WaitForCallsStatusTimeoutError"})}}function $e(e,t){if(e.length!==t.length)throw new Q({expectedLength:e.length,givenLength:t.length});const n=[];for(let s=0;s<e.length;s++){const r=e[s],i=t[s];n.push(R(r,i))}return w(n)}function R(e,t,n=!1){if(e==="address"){const o=t;if(!z(o))throw new I({address:o});return B(o.toLowerCase(),{size:n?32:null})}if(e==="string")return X(t);if(e==="bytes")return t;if(e==="bool")return B(Y(t),{size:n?32:1});const s=e.match(J);if(s){const[o,a,l="256"]=s,f=Number.parseInt(l,10)/8;return u(t,{size:n?32:f,signed:a==="int"})}const r=e.match(Z);if(r){const[o,a]=r;if(Number.parseInt(a,10)!==(t.length-2)/2)throw new ee({expectedSize:Number.parseInt(a,10),givenSize:(t.length-2)/2});return B(t,{dir:"right",size:n?32:null})}const i=e.match(te);if(i&&Array.isArray(t)){const[o,a]=i,l=[];for(let f=0;f<t.length;f++)l.push(R(a,t[f],!0));return l.length===0?"0x":w(l)}throw new se(e)}function Ge(e){const{authorizationList:t}=e;if(t)for(const n of t){const{chainId:s}=n,r=n.address;if(!z(r))throw new I({address:r});if(s<0)throw new L({chainId:s})}N(e)}function Se(e){const{blobVersionedHashes:t}=e;if(t){if(t.length===0)throw new re;for(const n of t){const s=ie(n),r=M(ae(n,0,1));if(s!==32)throw new oe({hash:n,size:s});if(r!==ce)throw new ue({hash:n,version:r})}}N(e)}function N(e){const{chainId:t,maxPriorityFeePerGas:n,maxFeePerGas:s,to:r}=e;if(t<=0)throw new L({chainId:t});if(r&&!z(r))throw new I({address:r});if(s&&s>k)throw new H({maxFeePerGas:s});if(n&&s&&n>s)throw new ne({maxFeePerGas:s,maxPriorityFeePerGas:n})}function Le(e){const{chainId:t,maxPriorityFeePerGas:n,gasPrice:s,maxFeePerGas:r,to:i}=e;if(t<=0)throw new L({chainId:t});if(i&&!z(i))throw new I({address:i});if(n||r)throw new S("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid EIP-2930 Transaction attribute.");if(s&&s>k)throw new H({maxFeePerGas:s})}function Ae(e){const{chainId:t,maxPriorityFeePerGas:n,gasPrice:s,maxFeePerGas:r,to:i}=e;if(i&&!z(i))throw new I({address:i});if(typeof t<"u"&&t<=0)throw new L({chainId:t});if(n||r)throw new S("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid Legacy Transaction attribute.");if(s&&s>k)throw new H({maxFeePerGas:s})}function A(e){if(!e||e.length===0)return[];const t=[];for(let n=0;n<e.length;n++){const{address:s,storageKeys:r}=e[n];for(let i=0;i<r.length;i++)if(r[i].length-2!==64)throw new fe({storageKey:r[i]});if(!z(s,{strict:!1}))throw new I({address:s});t.push([s,r])}return t}function je(e,t){const n=le(e);return n==="eip1559"?ke(e,t):n==="eip2930"?He(e,t):n==="eip4844"?Me(e,t):n==="eip7702"?Be(e,t):Ne(e,t)}function Be(e,t){const{authorizationList:n,chainId:s,gas:r,nonce:i,to:o,value:a,maxFeePerGas:l,maxPriorityFeePerGas:f,accessList:c,data:x}=e;Ge(e);const h=A(c),d=Ve(n);return w(["0x04",P([u(s),i?u(i):"0x",f?u(f):"0x",l?u(l):"0x",r?u(r):"0x",o??"0x",a?u(a):"0x",x??"0x",h,d,...C(e,t)])])}function Me(e,t){const{chainId:n,gas:s,nonce:r,to:i,value:o,maxFeePerBlobGas:a,maxFeePerGas:l,maxPriorityFeePerGas:f,accessList:c,data:x}=e;Se(e);let h=e.blobVersionedHashes,d=e.sidecars;if(e.blobs&&(typeof h>"u"||typeof d>"u")){const g=typeof e.blobs[0]=="string"?e.blobs:e.blobs.map(E=>de(E)),G=e.kzg,v=he({blobs:g,kzg:G});if(typeof h>"u"&&(h=xe({commitments:v})),typeof d>"u"){const E=me({blobs:g,commitments:v,kzg:G});d=be({blobs:g,commitments:v,proofs:E})}}const y=A(c),b=[u(n),r?u(r):"0x",f?u(f):"0x",l?u(l):"0x",s?u(s):"0x",i??"0x",o?u(o):"0x",x??"0x",y,a?u(a):"0x",h??[],...C(e,t)],m=[],T=[],p=[];if(d)for(let g=0;g<d.length;g++){const{blob:G,commitment:v,proof:E}=d[g];m.push(G),T.push(v),p.push(E)}return w(["0x03",d?P([b,m,T,p]):P(b)])}function ke(e,t){const{chainId:n,gas:s,nonce:r,to:i,value:o,maxFeePerGas:a,maxPriorityFeePerGas:l,accessList:f,data:c}=e;N(e);const x=A(f),h=[u(n),r?u(r):"0x",l?u(l):"0x",a?u(a):"0x",s?u(s):"0x",i??"0x",o?u(o):"0x",c??"0x",x,...C(e,t)];return w(["0x02",P(h)])}function He(e,t){const{chainId:n,gas:s,data:r,nonce:i,to:o,value:a,accessList:l,gasPrice:f}=e;Le(e);const c=A(l),x=[u(n),i?u(i):"0x",f?u(f):"0x",s?u(s):"0x",o??"0x",a?u(a):"0x",r??"0x",c,...C(e,t)];return w(["0x01",P(x)])}function Ne(e,t){const{chainId:n=0,gas:s,data:r,nonce:i,to:o,value:a,gasPrice:l}=e;Ae(e);let f=[i?u(i):"0x",l?u(l):"0x",s?u(s):"0x",o??"0x",a?u(a):"0x",r??"0x"];if(t){const c=(()=>{if(t.v>=35n)return(t.v-35n)/2n>0?t.v:27n+(t.v===35n?0n:1n);if(n>0)return BigInt(n*2)+BigInt(35n+t.v-27n);const d=27n+(t.v===27n?0n:1n);if(t.v!==d)throw new ge({v:t.v});return d})(),x=F(t.r),h=F(t.s);f=[...f,u(c),x==="0x00"?"0x":x,h==="0x00"?"0x":h]}else n>0&&(f=[...f,u(n),"0x","0x"]);return P(f)}function C(e,t){const n=t??e,{v:s,yParity:r}=n;if(typeof n.r>"u")return[];if(typeof n.s>"u")return[];if(typeof s>"u"&&typeof r>"u")return[];const i=F(n.r),o=F(n.s);return[typeof r=="number"?r?u(1):"0x":s===0n?"0x":s===1n?u(1):s===27n?"0x":u(1),i==="0x00"?"0x":i,o==="0x00"?"0x":o]}function Ve(e){if(!e||e.length===0)return[];const t=[];for(const n of e){const{chainId:s,nonce:r,...i}=n,o=n.address;t.push([s?O(s):"0x",o,r?O(r):"0x",...C({},i)])}return t}function Ke(e){const{source:t}=e,n=new Map,s=new ye(8192),r=new Map,i=({address:o,chainId:a})=>`${o}.${a}`;return{async consume({address:o,chainId:a,client:l}){const f=i({address:o,chainId:a}),c=this.get({address:o,chainId:a,client:l});this.increment({address:o,chainId:a});const x=await c;return await t.set({address:o,chainId:a},x),s.set(f,x),x},async increment({address:o,chainId:a}){const l=i({address:o,chainId:a}),f=n.get(l)??0;n.set(l,f+1)},async get({address:o,chainId:a,client:l}){const f=i({address:o,chainId:a});let c=r.get(f);return c||(c=(async()=>{try{const h=await t.get({address:o,chainId:a,client:l}),d=s.get(f)??0;return d>0&&h<=d?d+1:(s.delete(f),h)}finally{this.reset({address:o,chainId:a})}})(),r.set(f,c)),(n.get(f)??0)+await c},reset({address:o,chainId:a}){const l=i({address:o,chainId:a});n.delete(l),r.delete(l)}}}const _e="0x6492649264926492649264926492649264926492649264926492649264926492";function Ue(e){const{address:t,data:n,signature:s,to:r="hex"}=e,i=w([pe([{type:"address"},{type:"bytes"},{type:"bytes"}],[t,n,s]),_e]);return r==="hex"?i:we(i)}function We(e){const{key:t="public",name:n="Public Client"}=e;return Pe({...e,key:t,name:n,type:"publicClient"}).extend(ze)}function De(e){const{r:t,s:n}=Ie.Signature.fromCompact(e.slice(2,130)),s=+`0x${e.slice(130)}`,[r,i]=(()=>{if(s===0||s===1)return[void 0,s];if(s===27)return[BigInt(s),0];if(s===28)return[BigInt(s),1];throw new Error("Invalid yParityOrV value")})();return typeof r<"u"?{r:u(t,{size:32}),s:u(n,{size:32}),v:r,yParity:i}:{r:u(t,{size:32}),s:u(n,{size:32}),yParity:i}}export{Te as B,Ce as W,Ke as a,N as b,We as c,Le as d,$e as e,Ae as f,A as g,je as h,De as p,Ue as s,Re as w};
